打算采用传统的mySQL数据库

# 数据库设计原则

- 主键尽量无意义，可以采用自增的ID。
  - 为什么？[(3条消息) mysql主键无意义_数据库主键不应该具有任何业务意义_领研网的博客-CSDN博客](https://blog.csdn.net/weixin_35695142/article/details/113421730)
  - 为什么尽量不要采用用户名\邮箱作为主键？想象这样一个场景：有一个用户可能需要管理员修改邮箱\用户名，如果有其他表的话，可能会互相影响。对于主键，就算是一个简单的改变，也可能会造成极大的维护上的开销。
- 是否采用外键存储？
  - 为什么不推荐使用外键？[数据库不推荐使用外键约束的原因 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/516713774)
  - 这个系统使用不使用都行，对于外键的性能、并发、扩展性问题的缺点都是可以接受的
- 是否采用KV (Key-Value) 结构？
  - [Mysql中Key-Value键值对结构的组合查询条件 - Lenbo's Blog (lbog.cn)](http://www.lbog.cn/blog/15)
  - KV结构优点：方便扩展，节约空间（虽然这个系统数据量也不大）
  - 缺点：查询和编码复杂
- 在设计时尽量包含两个日期字段:crt_time (创建日期),upd_time (修改日期) 且 非空，对表的记录进行更新的时候，必须包含对 upd_time 字段的更新。

# 数据库设计

每个表默认包含create_time, update_time，[(3条消息) 【MySQL-技术】MySQL数据库自动添加创建时间、更新时间（超详细版）_大王绕命丶的博客-CSDN博客_mysql自动生成创建时间](https://blog.csdn.net/A1924/article/details/117074646)

主键默认为ID，[(3条消息) MySQL 自增主键_人间世庄子的博客-CSDN博客_mysql 主键自增](https://blog.csdn.net/rjszz1314/article/details/122866094)

## 用户信息

表名：user

| 字段名   | 字段说明       | 字段类型     | 是否必要 | 是否唯一 | 备注                                                         |
| -------- | -------------- | ------------ | -------- | -------- | ------------------------------------------------------------ |
| name     | 用户名称       | varchar(16)  | 是       | 是       | 太长了不方便前端展示                                         |
| email    | 用户邮箱       | varchar(64)  | 是       | 是       | 后期可能可用于找回账号，邮箱的正确性用前端和后端+正则约束    |
| type     | 用户类型       | enum         | 是       | 否       | administrator/teacher/student                                |
| qq       | 用户的qq       | varchar(16)  | 否       | 否       |                                                              |
| about    | 一句话描述自己 | varchar(100) | 否       | 否       |                                                              |
| password | 密码           | varchar(64)  | 是       | 否       | 加密后的密码。**由于业务逻辑有所差异，是否需要把密码单独拆出来建一个表？** |

username太长了可能就像codeforces这样（尝试注册了一个长用户名的账号）：![image-20221102170056295](C:\Users\94091\AppData\Roaming\Typora\typora-user-images\image-20221102170056295.png)

后续有必要的话，可以添加学号/入学年份等信息

## 用户平台

表名：user_platform_handle

K-V结构，方便扩展多个平台

| 字段名   | 字段说明                   | 字段类型    | 是否必要 | 是否唯一 | 备注                                                         |
| -------- | -------------------------- | ----------- | -------- | -------- | ------------------------------------------------------------ |
| name     | 用户名称                   | varchar(16) | 是       | 否       | 与user_infomation相同，用业务逻辑保证数据的完整性和一致性    |
| platform | 平台                       | varchar(16) | 是       | 否       | LeetCode/Codeforces/AtCoder/Topcoder                         |
| handle   | 用户在不同平台的账号handle | varchar(64) | 是       | 否       | codeforces是24个字符或以下，atcoder是16个字符或以下，leetcode是30个字符或以下，topcode是或15个字符以下 |

## 用户关注

表名：user_follow

| 字段名      | 字段说明     | 字段类型    | 是否必要 | 是否唯一 | 备注                                                      |
| ----------- | ------------ | ----------- | -------- | -------- | --------------------------------------------------------- |
| name        | 用户名称     | varchar(16) | 是       | 否       | 与user_infomation相同，用业务逻辑保证数据的完整性和一致性 |
| follow_name | 关注用户名称 | varchar(16) | 是       | 否       | 与user_infomation相同，用业务逻辑保证数据的完整性和一致性 |
| nickname    | 昵称         | varchar(16) | 否       | 否       | 在关注列表展示的昵称（备注）                              |

## 提交信息

有没有一种说法，就是不储存用户提交，直接调用CodeForces/LeetCode的API？

**不行，查看单个用户可以，但是查看排行榜等汇总数据时就非常缓慢**

表名: user_submission

| 字段名        | 字段说明   | 字段类型    | 是否必要 | 是否唯一 | 备注                                                      |
| ------------- | ---------- | ----------- | -------- | -------- | --------------------------------------------------------- |
| user_name     | 用户名称   | varchar(16) | 是       | 否       | 与user_infomation相同，用业务逻辑保证数据的完整性和一致性 |
| platform      | 平台       | enum        | 是       | 否       | Codeforces/LeetCode                                       |
| submission_id | 提交id     | int         | 是       | 否       | 是自增型的一个变量                                        |
| contest_id    | 竞赛id     | int         | 否       | 否       |                                                           |
| problem_id    | 问题id     | int         | 是       | 否       |                                                           |
| submit_time   | 提交时间戳 | timestamp   | 是       | 否       |                                                           |
| status        | 提交状态   | enum        | 是       | 否       |                                                           |

![image-20221102205049531](C:\Users\94091\AppData\Roaming\Typora\typora-user-images\image-20221102205049531.png)

力扣提交链接：https://leetcode.cn/submissions/detail/375662062/

力扣问题链接：https://leetcode.cn/problems/merge-strings-alternately/

## 问题信息

表名：problem

| 字段名     | 字段说明                             | 字段类型    | 是否必要 | 是否唯一 | 备注                   |
| ---------- | ------------------------------------ | ----------- | -------- | -------- | ---------------------- |
| id         | 题目id                               | bigint      | 是       | 是       |                        |
| platform   | 平台                                 | varchar(12) | 是       | 否       |                        |
| name       | 问题名称                             | varchar(16) | 是       | 否       |                        |
| name_slug  | 力扣问题链接的一部分，一般是标题拼音 | varchar(32) | 否       | 否       |                        |
| difficulty | 难度                                 | varchar(6)  | 否       | 否       | 力扣：easy/medium/hard |
| rating     | 评级                                 | int         | 否       | 否       | CF有                   |
| contest_id | 竞赛id                               | int         | 否       | 否       | CF链接                 |

![image-20221102220349010](C:\Users\94091\AppData\Roaming\Typora\typora-user-images\image-20221102220349010.png)

CF提交链接：https://codeforces.com/contest/1721/submission/178071356

CF问题链接：https://codeforces.com/problemset/problem/231/A

## 问题标签

表名：problem_tag

| 字段名 | 字段说明 | 字段类型    | 是否必要 | 是否唯一 | 备注 |
| ------ | -------- | ----------- | -------- | -------- | ---- |
| id     | 问题名称 | varchar(16) | 是       | 否       |      |
| tag    | 标签     | varchar(32) | 是       | 否       |      |